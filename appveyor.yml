version: '0.4.1.{build}'

environment:
#  global:
      # Example can be found here https://github.com/quantopian/zipline/blob/master/appveyor.yml
#      ANACONDA_TOKEN: # not required anymore since it is configured at AppVeyor
  matrix:
    - PYTHON_LOC: "C:\\Miniconda37-x64"
      PYTHON_VERSION: 3.7

install:
  - cmd: call %PYTHON_LOC%\Scripts\activate.bat
  - cmd: conda config --set always_yes yes --set changeps1 no
  - cmd: conda update -q conda
  - cmd: conda info -a

build_script:
  - cmd: echo 'Building gridtools using branch %APPVEYOR_REPO_BRANCH%'
    # Activate root environment and install build and upload tools
  - cmd: call %PYTHON_LOC%\Scripts\activate.bat root
  - cmd: conda install conda-build conda-verify anaconda-client
    # Build the image and its variants
  - cmd: conda build --old-build-string -c conda-forge -c anaconda recipes\gridtools
    # Upload the images to the anaconda cloud only if in master branch
  - cmd: if %APPVEYOR_REPO_BRANCH% == master upload_to_anaconda_cloud %ANACONDA_TOKEN%
